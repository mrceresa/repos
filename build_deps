#!/usr/bin/env bash

source defs.sh

declare -a deps=(libodb-mysql vxl InsightToolkit ITK-BinaryAttributeMorphology)

for target in "${targets[@]}"
do
    t=$target
    echo "Building target "$t
    
    ## Initialize buildroot
    mock init -r $t
    
    # Build and install required software from the internal repository
    build_target $t libodb -1.4.0-1
    ./update_repo
    
    mock -r $t install libodb-devel
    
    
    if [ ! "$?" -eq $SUCCESS ]
    then
	echo "Problem installing libodb. Please check."
	echo "Dependency build aborted"
	exit
    fi
    
    
    for dep in "${deps[@]}"
    do
	echo "Analyzing dependency "$dep
	num=$(find $repoLocalDir/$target -name "$dep*" | wc | awk '{print $1}')
	echo "Found "$num" rpms in repository"
	if [ "$num" = "0" ]
	then
	    echo "Building " $dep
	    build_target $t $dep
	    # Make newly built packages available as dependecies for the next ones
	    ./update_db
        else
	     echo "."
	fi

    done
done


